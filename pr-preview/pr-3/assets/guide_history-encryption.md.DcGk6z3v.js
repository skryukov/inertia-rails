import{_ as h,K as r,f as o,g as p,a5 as d,N as t,y as a,h as i,v as e}from"./chunks/framework._I0PdzNh.js";const C=JSON.parse('{"title":"History encryption","description":"","frontmatter":{},"headers":[],"relativePath":"guide/history-encryption.md","filePath":"guide/history-encryption.md"}'),k={name:"guide/history-encryption.md"};function c(y,s,g,u,b,E){const n=r("PluginTabsTab"),l=r("PluginTabs");return p(),o("div",null,[s[4]||(s[4]=d(`<h1 id="history-encryption" tabindex="-1">History encryption <a class="header-anchor" href="#history-encryption" aria-label="Permalink to &quot;History encryption&quot;">​</a></h1><p>Imagine a scenario where your user is authenticated, browses privileged information on your site, then logs out. If they press the back button, they can still see the privileged information that is stored in the window&#39;s history state. This is a security risk. To prevent this, Inertia.js provides a history encryption feature.</p><h2 id="how-it-works" tabindex="-1">How it works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How it works&quot;">​</a></h2><p>When you instruct Inertia to encrypt your app&#39;s history, it uses the browser&#39;s built-in <a href="https://developer.mozilla.org/en-US/docs/Web/API/Crypto" target="_blank" rel="noreferrer"><code>crypto</code> api</a> to encrypt the current page&#39;s data before pushing it to the history state. We store the corresponding key in the browser&#39;s session storage. When the user navigates back to a page, we decrypt the data using the key stored in the session storage.</p><p>Once you instruct Inertia to clear your history state, we simply clear the existing key from session storage and roll out a new one. If we attempt to decrypt the history state with the new key, it will fail and Inertia will make a fresh request back to your server for the page data.</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>History encryption relies on <code>window.crypto.subtle</code> which is only available in secure environments (sites with SSL enabled).</p></div><h2 id="opting-in" tabindex="-1">Opting in <a class="header-anchor" href="#opting-in" aria-label="Permalink to &quot;Opting in&quot;">​</a></h2><p>History encryption is an opt-in feature. There are several methods for enabling it.</p><h3 id="global-encryption" tabindex="-1">Global encryption <a class="header-anchor" href="#global-encryption" aria-label="Permalink to &quot;Global encryption&quot;">​</a></h3><p>If you&#39;d like to enable history encryption globally, set the <code>encrypt_history</code> config value to <code>true</code>.</p><p>You are able to opt out of encryption on specific pages by passing <code>false</code> to the <code>encrypt_history</code> option.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">inertia:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Homepage&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">props:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">encrypt_history:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span></code></pre></div><h3 id="per-request-encryption" tabindex="-1">Per-request encryption <a class="header-anchor" href="#per-request-encryption" aria-label="Permalink to &quot;Per-request encryption&quot;">​</a></h3><p>To encrypt the history of an individual request, simply pass <code>true</code> to the <code>encrypt_history</code> option.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">inertia:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Dashboard&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">props:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">encrypt_history:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span></code></pre></div><h3 id="controller-level-encryption" tabindex="-1">Controller-level encryption <a class="header-anchor" href="#controller-level-encryption" aria-label="Permalink to &quot;Controller-level encryption&quot;">​</a></h3><p>You can also enable history encryption for all actions in a controller by setting the <code>encrypt_history</code> config value in the controller.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> DashboardController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ApplicationController</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  inertia_config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">encrypt_history:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><h2 id="clearing-history" tabindex="-1">Clearing history <a class="header-anchor" href="#clearing-history" aria-label="Permalink to &quot;Clearing history&quot;">​</a></h2><p>To clear the history state on the server side, you can pass the <code>clear_history</code> option to the <code>render</code> method.</p><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">render </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">inertia:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Dashboard&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">props:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">clear_history:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span></code></pre></div><p>Once the response has rendered on the client, the encryption key will be rotated, rendering the previous history state unreadable.</p><h3 id="client-side-clearing" tabindex="-1">Client-side clearing <a class="header-anchor" href="#client-side-clearing" aria-label="Permalink to &quot;Client-side clearing&quot;">​</a></h3><p>You can also clear history directly on the client side by calling the <code>router.clearHistory()</code> method.</p>`,24)),t(l,{sharedStateKey:"frameworks"},{default:a(()=>[t(n,{label:"Vue"},{default:a(()=>s[0]||(s[0]=[i("div",{class:"language-js vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"js"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { router } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"from"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '@inertiajs/vue3'")]),e(`
`),i("span",{class:"line"}),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"router."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"clearHistory"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")])])])],-1)])),_:1}),t(n,{label:"React"},{default:a(()=>s[1]||(s[1]=[i("div",{class:"language-js vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"js"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { router } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"from"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '@inertiajs/react'")]),e(`
`),i("span",{class:"line"}),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"router."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"clearHistory"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")])])])],-1)])),_:1}),t(n,{label:"Svelte 4"},{default:a(()=>s[2]||(s[2]=[i("div",{class:"language-js vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"js"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { router } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"from"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '@inertiajs/svelte'")]),e(`
`),i("span",{class:"line"}),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"router."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"clearHistory"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")])])])],-1)])),_:1}),t(n,{label:"Svelte 5"},{default:a(()=>s[3]||(s[3]=[i("div",{class:"language-js vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"js"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { router } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"from"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '@inertiajs/svelte'")]),e(`
`),i("span",{class:"line"}),e(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"router."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"clearHistory"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")])])])],-1)])),_:1})]),_:1})])}const v=h(k,[["render",c]]);export{C as __pageData,v as default};
